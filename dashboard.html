<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TaskMaster</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }

        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
            color: white;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .balance {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .logout-btn {
            background: transparent;
            color: white;
            border: 1px solid white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: white;
            color: #667eea;
        }

        /* Main Container */
        .container {
            display: flex;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .sidebar-menu li:hover {
            background: #f0f0f0;
            color: #667eea;
        }

        .sidebar-menu li.active {
            background: #667eea;
            color: white;
        }

        .sidebar-menu li i {
            width: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Welcome Banner */
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .welcome-banner h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .stat-info h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .stat-icon {
            font-size: 2.5rem;
            color: #667eea;
            opacity: 0.5;
        }

        /* Section Titles */
        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
        }

        /* Task Categories */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .category-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .category-price {
            color: #28a745;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .category-tasks {
            color: #666;
            font-size: 14px;
        }

        /* Tasks Grid */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .task-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-category {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        .task-price {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .task-title {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .task-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .task-deadline {
            color: #dc3545;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-available {
            background: #28a745;
            color: white;
        }

        .status-submitted {
            background: #ffc107;
            color: #333;
        }

        .status-approved {
            background: #17a2b8;
            color: white;
        }

        .status-rejected {
            background: #dc3545;
            color: white;
        }

        .submit-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .submit-btn:hover {
            background: #5a67d8;
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .submit-task-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
        }

        .submit-task-btn:hover {
            background: #218838;
        }

        /* Submissions Table */
        .submissions-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            background: #f8f9fa;
            padding: 15px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #dee2e6;
        }

        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            align-items: center;
        }

        .table-row:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            width: fit-content;
        }

        .badge-pending {
            background: #ffc107;
            color: #333;
        }

        .badge-approved {
            background: #28a745;
            color: white;
        }

        .badge-rejected {
            background: #dc3545;
            color: white;
        }

        .badge-completed {
            background: #17a2b8;
            color: white;
        }

        .view-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Withdrawals Section */
        .withdrawals-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .withdrawal-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .withdrawal-form h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .withdrawal-history {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .withdrawal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .withdrawal-item:last-child {
            border-bottom: none;
        }

        .withdrawal-amount {
            font-weight: bold;
            color: #333;
        }

        .withdrawal-method {
            color: #666;
            font-size: 14px;
        }

        .withdrawal-date {
            color: #999;
            font-size: 12px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Feedback Section */
        .feedback-section {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .feedback-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }

        .feedback-text {
            color: #333;
            font-size: 14px;
        }

        .admin-feedback {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .withdrawals-container {
                grid-template-columns: 1fr;
            }

            .table-header, .table-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html" class="logo">TaskMaster</a>
        <div class="user-menu">
            <div class="balance" id="balance">$0.00</div>
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">User</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li class="active" onclick="showSection('dashboard')">
                    <i>üìä</i> Dashboard
                </li>
                <li onclick="showSection('tasks')">
                    <i>üìã</i> Available Tasks
                </li>
                <li onclick="showSection('submissions')">
                    <i>üìù</i> My Submissions
                </li>
                <li onclick="showSection('withdrawals')">
                    <i>üí∞</i> Withdrawals
                </li>
                <li onclick="showSection('feedback')">
                    <i>üí¨</i> Feedback
                </li>
                <li onclick="showSection('profile')">
                    <i>üë§</i> Profile
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection">
                <div class="welcome-banner">
                    <h1>Welcome back, <span id="welcomeName">User</span>!</h1>
                    <p>Complete tasks and earn money today.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>Total Earnings</h3>
                            <div class="stat-number" id="totalEarnings">$0</div>
                        </div>
                        <div class="stat-icon">üí∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>Available Balance</h3>
                            <div class="stat-number" id="availableBalance">$0</div>
                        </div>
                        <div class="stat-icon">üíµ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>Tasks Completed</h3>
                            <div class="stat-number" id="tasksCompleted">0</div>
                        </div>
                        <div class="stat-icon">‚úÖ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-info">
                            <h3>Pending Approval</h3>
                            <div class="stat-number" id="pendingTasks">0</div>
                        </div>
                        <div class="stat-icon">‚è≥</div>
                    </div>
                </div>

                <h2 class="section-title">Task Categories</h2>
                <div class="categories-grid" id="categoriesList">
                    <!-- Categories will be loaded here -->
                </div>

                <h2 class="section-title">Recent Available Tasks</h2>
                <div class="tasks-grid" id="recentTasks">
                    <!-- Recent tasks will be loaded here -->
                </div>
            </div>

            <!-- Tasks Section -->
            <div id="tasksSection" style="display: none;">
                <h2 class="section-title">Available Tasks</h2>
                
                <div class="filters" style="margin-bottom: 20px;">
                    <select id="categoryFilter" onchange="filterTasks()" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                        <option value="all">All Categories</option>
                    </select>
                    <select id="sortFilter" onchange="filterTasks()" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin-left: 10px;">
                        <option value="newest">Newest First</option>
                        <option value="price-high">Highest Price</option>
                        <option value="price-low">Lowest Price</option>
                    </select>
                </div>

                <div class="tasks-grid" id="allTasks">
                    <!-- All tasks will be loaded here -->
                </div>
            </div>

            <!-- Submissions Section -->
            <div id="submissionsSection" style="display: none;">
                <h2 class="section-title">My Submissions</h2>
                
                <div class="submissions-table">
                    <div class="table-header">
                        <div>Task</div>
                        <div>Submitted</div>
                        <div>Amount</div>
                        <div>Status</div>
                        <div>Action</div>
                    </div>
                    <div id="submissionsList">
                        <!-- Submissions will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Withdrawals Section -->
            <div id="withdrawalsSection" style="display: none;">
                <h2 class="section-title">Withdrawals</h2>
                
                <div class="withdrawals-container">
                    <div class="withdrawal-form">
                        <h3>Request Withdrawal</h3>
                        <div class="form-group">
                            <label>Amount ($)</label>
                            <input type="number" id="withdrawAmount" min="10" step="0.01" placeholder="Enter amount">
                            <small style="color: #666;">Minimum withdrawal: $10</small>
                        </div>
                        <div class="form-group">
                            <label>Payment Method</label>
                            <select id="paymentMethod">
                                <option value="paypal">PayPal</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="crypto">Cryptocurrency</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Account Details</label>
                            <textarea id="accountDetails" placeholder="Enter your account details for payment" rows="3"></textarea>
                        </div>
                        <button class="submit-task-btn" onclick="requestWithdrawal()">Request Withdrawal</button>
                    </div>

                    <div class="withdrawal-history">
                        <h3>Withdrawal History</h3>
                        <div id="withdrawalHistory">
                            <!-- Withdrawal history will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feedback Section -->
            <div id="feedbackSection" style="display: none;">
                <h2 class="section-title">Feedback & Reviews</h2>
                
                <div class="feedback-section" id="feedbackList">
                    <!-- Feedback will be loaded here -->
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" style="display: none;">
                <h2 class="section-title">Profile Settings</h2>
                
                <div style="background: white; padding: 30px; border-radius: 10px;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileName" value="">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profileEmail" value="" readonly>
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="profilePhone" placeholder="Enter your phone number">
                    </div>
                    <div class="form-group">
                        <label>PayPal Email</label>
                        <input type="email" id="profilePaypal" placeholder="Enter your PayPal email">
                    </div>
                    <div class="form-group">
                        <label>Bank Account Details</label>
                        <textarea id="profileBank" placeholder="Enter your bank account details" rows="3"></textarea>
                    </div>
                    <button class="submit-task-btn" onclick="updateProfile()">Update Profile</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Task Modal -->
    <div id="submitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submit Task</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="taskDetails"></div>
                
                <div class="form-group">
                    <label>Your Work</label>
                    <textarea id="submissionWork" placeholder="Describe your work or provide links/files" rows="5"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="submissionNotes" placeholder="Any additional information for the admin" rows="3"></textarea>
                </div>
                
                <button class="submit-task-btn" onclick="submitTask()">Submit Task</button>
            </div>
        </div>
    </div>

    <!-- View Submission Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submission Details</h2>
                <button class="close-btn" onclick="closeViewModal()">&times;</button>
            </div>
            <div class="modal-body" id="viewModalBody">
                <!-- Submission details will be loaded here -->
            </div>
        </div>
    </div>

    <script type="module">
        import { 
            auth,
            db,
            signOut,
            onAuthStateChanged,
            collection,
            addDoc,
            query,
            where,
            orderBy,
            onSnapshot,
            updateDoc,
            deleteDoc,
            doc,
            getDoc,
            getDocs,
            serverTimestamp,
            arrayUnion
        } from './js/firebase-config.js';

        // Global variables
        let currentUser = null;
        let currentTaskId = null;
        let userBalance = 0;
        let userData = {};

        // Show loading overlay
        function showLoading(show = true) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Show message (you can implement this)
        function showMessage(text, type) {
            alert(text); // Simple alert for now, you can enhance this
        }

        // Logout
        window.logout = async function() {
            showLoading(true);
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                showMessage('Error logging out', 'error');
            } finally {
                showLoading(false);
            }
        };

        // Show different sections
        window.showSection = function(section) {
            // Hide all sections
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('tasksSection').style.display = 'none';
            document.getElementById('submissionsSection').style.display = 'none';
            document.getElementById('withdrawalsSection').style.display = 'none';
            document.getElementById('feedbackSection').style.display = 'none';
            document.getElementById('profileSection').style.display = 'none';

            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu li').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';

            // Add active class to clicked menu item
            event.target.closest('li').classList.add('active');

            // Load section data
            if (section === 'tasks') {
                loadAvailableTasks();
            } else if (section === 'submissions') {
                loadUserSubmissions();
            } else if (section === 'withdrawals') {
                loadWithdrawalHistory();
            } else if (section === 'feedback') {
                loadUserFeedback();
            }
        };

        // Load dashboard data
        function loadDashboard() {
            if (!currentUser) return;

            // Update welcome name
            document.getElementById('welcomeName').textContent = currentUser.displayName || 'User';
            document.getElementById('userName').textContent = currentUser.displayName || 'User';
            document.getElementById('userAvatar').textContent = (currentUser.displayName || 'U').charAt(0).toUpperCase();

            // Load categories
            loadCategories();

            // Load recent tasks
            loadRecentTasks();

            // Load user stats
            loadUserStats();
        }

        // Load categories
        function loadCategories() {
            const categories = [
                { name: 'Data Entry', icon: 'üìä', price: '5-20', count: 15, color: '#667eea' },
                { name: 'Content Writing', icon: '‚úçÔ∏è', price: '10-50', count: 8, color: '#764ba2' },
                { name: 'Testing', icon: 'üß™', price: '15-30', count: 12, color: '#28a745' },
                { name: 'Surveys', icon: 'üìù', price: '2-10', count: 25, color: '#ffc107' },
                { name: 'Design', icon: 'üé®', price: '20-100', count: 6, color: '#17a2b8' },
                { name: 'Social Media', icon: 'üì±', price: '1-5', count: 30, color: '#dc3545' }
            ];

            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = categories.map(cat => `
                <div class="category-card" onclick="showSection('tasks')" style="border-top: 4px solid ${cat.color}">
                    <div class="category-icon">${cat.icon}</div>
                    <h3>${cat.name}</h3>
                    <div class="category-price">$${cat.price}</div>
                    <div class="category-tasks">${cat.count} tasks available</div>
                </div>
            `).join('');

            // Populate category filter
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="all">All Categories</option>' + 
                categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
        }

        // Load recent tasks
        function loadRecentTasks() {
            // This would normally come from Firestore
            const tasks = [
                {
                    id: 1,
                    title: 'Data Entry Task',
                    description: 'Enter product information into spreadsheet',
                    price: 15,
                    category: 'Data Entry',
                    deadline: '2024-12-31',
                    status: 'available'
                },
                {
                    id: 2,
                    title: 'Write Product Review',
                    description: 'Write a 500-word review for a new product',
                    price: 25,
                    category: 'Content Writing',
                    deadline: '2024-12-30',
                    status: 'available'
                },
                {
                    id: 3,
                    title: 'Website Testing',
                    description: 'Test website functionality and report bugs',
                    price: 30,
                    category: 'Testing',
                    deadline: '2024-12-29',
                    status: 'available'
                }
            ];

            displayTasks(tasks, 'recentTasks');
        }

        // Load available tasks
        window.loadAvailableTasks = function() {
            // This would normally come from Firestore
            const tasks = [
                {
                    id: 1,
                    title: 'Data Entry Task',
                    description: 'Enter product information into spreadsheet',
                    price: 15,
                    category: 'Data Entry',
                    deadline: '2024-12-31',
                    status: 'available'
                },
                {
                    id: 2,
                    title: 'Write Product Review',
                    description: 'Write a 500-word review for a new product',
                    price: 25,
                    category: 'Content Writing',
                    deadline: '2024-12-30',
                    status: 'available'
                },
                {
                    id: 3,
                    title: 'Website Testing',
                    description: 'Test website functionality and report bugs',
                    price: 30,
                    category: 'Testing',
                    deadline: '2024-12-29',
                    status: 'available'
                },
                {
                    id: 4,
                    title: 'Market Survey',
                    description: 'Complete a 10-minute survey about consumer habits',
                    price: 8,
                    category: 'Surveys',
                    deadline: '2024-12-28',
                    status: 'available'
                },
                {
                    id: 5,
                    title: 'Logo Design',
                    description: 'Create a simple logo for a startup',
                    price: 50,
                    category: 'Design',
                    deadline: '2024-12-27',
                    status: 'available'
                },
                {
                    id: 6,
                    title: 'Social Media Engagement',
                    description: 'Like and share 20 posts',
                    price: 5,
                    category: 'Social Media',
                    deadline: '2024-12-26',
                    status: 'available'
                }
            ];

            displayTasks(tasks, 'allTasks');
        };

        // Display tasks
        function displayTasks(tasks, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = tasks.map(task => `
                <div class="task-card">
                    <div class="task-header">
                        <span class="task-category">${task.category}</span>
                        <span class="task-price">$${task.price}</span>
                    </div>
                    <div class="task-title">${task.title}</div>
                    <div class="task-description">${task.description}</div>
                    <div class="task-deadline">Deadline: ${task.deadline}</div>
                    <div class="task-footer">
                        <span class="task-status status-available">Available</span>
                        <button class="submit-btn" onclick="openSubmitModal(${task.id})">Submit Task</button>
                    </div>
                </div>
            `).join('');
        }

        // Filter tasks
        window.filterTasks = function() {
            const category = document.getElementById('categoryFilter').value;
            const sort = document.getElementById('sortFilter').value;
            
            // Filter and sort tasks (implement based on your data)
            loadAvailableTasks();
        };

        // Open submit modal
        window.openSubmitModal = function(taskId) {
            currentTaskId = taskId;
            
            // Get task details
            const taskDetails = {
                title: 'Sample Task',
                price: 15,
                description: 'Task description here'
            };
            
            document.getElementById('taskDetails').innerHTML = `
                <h3>${taskDetails.title}</h3>
                <p><strong>Reward:</strong> $${taskDetails.price}</p>
                <p>${taskDetails.description}</p>
            `;
            
            document.getElementById('submitModal').classList.add('active');
        };

        // Submit task
        window.submitTask = async function() {
            const work = document.getElementById('submissionWork').value.trim();
            const notes = document.getElementById('submissionNotes').value.trim();

            if (!work) {
                showMessage('Please describe your work', 'error');
                return;
            }

            showLoading(true);

            try {
                // Save submission to Firestore
                await addDoc(collection(db, 'submissions'), {
                    userId: currentUser.uid,
                    userName: currentUser.displayName,
                    taskId: currentTaskId,
                    work: work,
                    notes: notes,
                    status: 'pending',
                    submittedAt: new Date().toISOString(),
                    adminFeedback: []
                });

                showMessage('Task submitted successfully!', 'success');
                closeModal();
                loadUserSubmissions();

            } catch (error) {
                console.error('Submission error:', error);
                showMessage('Error submitting task', 'error');
            } finally {
                showLoading(false);
            }
        };

        // Close modal
        window.closeModal = function() {
            document.getElementById('submitModal').classList.remove('active');
            document.getElementById('submissionWork').value = '';
            document.getElementById('submissionNotes').value = '';
        };

        // Load user submissions
        async function loadUserSubmissions() {
            if (!currentUser) return;

            const submissionsList = document.getElementById('submissionsList');

            try {
                const q = query(
                    collection(db, 'submissions'),
                    where('userId', '==', currentUser.uid),
                    orderBy('submittedAt', 'desc')
                );

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    submissionsList.innerHTML = '<div class="table-row">No submissions yet</div>';
                    return;
                }

                submissionsList.innerHTML = '';
                querySnapshot.forEach(doc => {
                    const sub = doc.data();
                    submissionsList.innerHTML += `
                        <div class="table-row">
                            <div>Task #${sub.taskId}</div>
                            <div>${new Date(sub.submittedAt).toLocaleDateString()}</div>
                            <div>$${sub.reward || 'N/A'}</div>
                            <div><span class="status-badge badge-${sub.status}">${sub.status}</span></div>
                            <div><button class="view-btn" onclick="viewSubmission('${doc.id}')">View</button></div>
                        </div>
                    `;
                });

            } catch (error) {
                console.error('Error loading submissions:', error);
            }
        }

        // View submission
        window.viewSubmission = async function(submissionId) {
            try {
                const docRef = doc(db, 'submissions', submissionId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const sub = docSnap.data();
                    
                    let feedbackHtml = '';
                    if (sub.adminFeedback && sub.adminFeedback.length > 0) {
                        feedbackHtml = sub.adminFeedback.map(f => `
                            <div class="admin-feedback">
                                <strong>Admin:</strong> ${f.message}<br>
                                <small>${new Date(f.timestamp).toLocaleString()}</small>
                            </div>
                        `).join('');
                    }

                    document.getElementById('viewModalBody').innerHTML = `
                        <h3>Task #${sub.taskId}</h3>
                        <p><strong>Submitted:</strong> ${new Date(sub.submittedAt).toLocaleString()}</p>
                        <p><strong>Status:</strong> <span class="status-badge badge-${sub.status}">${sub.status}</span></p>
                        <p><strong>Your Work:</strong></p>
                        <p>${sub.work}</p>
                        ${sub.notes ? `<p><strong>Notes:</strong> ${sub.notes}</p>` : ''}
                        ${sub.review ? `<p><strong>Review:</strong> ${sub.review}</p>` : ''}
                        <div class="feedback-section">
                            <h4>Feedback</h4>
                            ${feedbackHtml || 'No feedback yet'}
                        </div>
                    `;

                    document.getElementById('viewModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading submission:', error);
            }
        };

        // Close view modal
        window.closeViewModal = function() {
            document.getElementById('viewModal').classList.remove('active');
        };

        // Request withdrawal
        window.requestWithdrawal = async function() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const method = document.getElementById('paymentMethod').value;
            const details = document.getElementById('accountDetails').value.trim();

            if (!amount || amount < 10) {
                showMessage('Minimum withdrawal amount is $10', 'error');
                return;
            }

            if (!details) {
                showMessage('Please enter your account details', 'error');
                return;
            }

            if (amount > userBalance) {
                showMessage('Insufficient balance', 'error');
                return;
            }

            showLoading(true);

            try {
                await addDoc(collection(db, 'withdrawals'), {
                    userId: currentUser.uid,
                    userName: currentUser.displayName,
                    amount: amount,
                    method: method,
                    accountDetails: details,
                    status: 'pending',
                    requestedAt: new Date().toISOString()
                });

                showMessage('Withdrawal request submitted!', 'success');
                
                // Clear form
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('accountDetails').value = '';

                // Refresh withdrawal history
                loadWithdrawalHistory();

            } catch (error) {
                console.error('Withdrawal error:', error);
                showMessage('Error requesting withdrawal', 'error');
            } finally {
                showLoading(false);
            }
        };

        // Load withdrawal history
        async function loadWithdrawalHistory() {
            if (!currentUser) return;

            const historyDiv = document.getElementById('withdrawalHistory');

            try {
                const q = query(
                    collection(db, 'withdrawals'),
                    where('userId', '==', currentUser.uid),
                    orderBy('requestedAt', 'desc')
                );

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    historyDiv.innerHTML = '<p>No withdrawal history</p>';
                    return;
                }

                historyDiv.innerHTML = '';
                querySnapshot.forEach(doc => {
                    const w = doc.data();
                    historyDiv.innerHTML += `
                        <div class="withdrawal-item">
                            <div>
                                <div class="withdrawal-amount">$${w.amount}</div>
                                <div class="withdrawal-method">${w.method}</div>
                                <div class="withdrawal-date">${new Date(w.requestedAt).toLocaleDateString()}</div>
                            </div>
                            <div><span class="status-badge badge-${w.status}">${w.status}</span></div>
                        </div>
                    `;
                });

            } catch (error) {
                console.error('Error loading withdrawals:', error);
            }
        }

        // Load user feedback
        async function loadUserFeedback() {
            if (!currentUser) return;

            const feedbackDiv = document.getElementById('feedbackList');

            try {
                const q = query(
                    collection(db, 'feedback'),
                    where('userId', '==', currentUser.uid),
                    orderBy('createdAt', 'desc')
                );

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    feedbackDiv.innerHTML = '<p>No feedback yet</p>';
                    return;
                }

                feedbackDiv.innerHTML = '';
                querySnapshot.forEach(doc => {
                    const f = doc.data();
                    feedbackDiv.innerHTML += `
                        <div class="feedback-item">
                            <div class="feedback-header">
                                <span>Task #${f.taskId}</span>
                                <span>${new Date(f.createdAt).toLocaleDateString()}</span>
                            </div>
                            <div class="feedback-text">${f.message}</div>
                            ${f.adminResponse ? `
                                <div class="admin-feedback">
                                    <strong>Admin Response:</strong> ${f.adminResponse}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

            } catch (error) {
                console.error('Error loading feedback:', error);
            }
        }

        // Load user stats
        async function loadUserStats() {
            if (!currentUser) return;

            try {
                // Get user balance from Firestore
                const userRef = doc(db, 'users', currentUser.uid);
                const userSnap = await getDoc(userRef);
                
                if (userSnap.exists()) {
                    userData = userSnap.data();
                    userBalance = userData.balance || 0;
                    
                    document.getElementById('balance').textContent = `$${userBalance.toFixed(2)}`;
                    document.getElementById('totalEarnings').textContent = `$${userData.totalEarnings || 0}`;
                    document.getElementById('availableBalance').textContent = `$${userBalance.toFixed(2)}`;
                }

                // Count submissions
                const submissionsQuery = query(
                    collection(db, 'submissions'),
                    where('userId', '==', currentUser.uid)
                );
                const submissionsSnap = await getDocs(submissionsQuery);
                
                let completed = 0;
                let pending = 0;
                
                submissionsSnap.forEach(doc => {
                    const status = doc.data().status;
                    if (status === 'approved') completed++;
                    else if (status === 'pending') pending++;
                });

                document.getElementById('tasksCompleted').textContent = completed;
                document.getElementById('pendingTasks').textContent = pending;

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Update profile
        window.updateProfile = async function() {
            const name = document.getElementById('profileName').value;
            const phone = document.getElementById('profilePhone').value;
            const paypal = document.getElementById('profilePaypal').value;
            const bank = document.getElementById('profileBank').value;

            showLoading(true);

            try {
                const userRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userRef, {
                    displayName: name,
                    phone: phone,
                    paypalEmail: paypal,
                    bankDetails: bank,
                    updatedAt: new Date().toISOString()
                });

                showMessage('Profile updated successfully!', 'success');
            } catch (error) {
                console.error('Profile update error:', error);
                showMessage('Error updating profile', 'error');
            } finally {
                showLoading(false);
            }
        };

        // Load profile data
        async function loadProfile() {
            if (!currentUser) return;

            document.getElementById('profileName').value = currentUser.displayName || '';
            document.getElementById('profileEmail').value = currentUser.email || '';

            try {
                const userRef = doc(db, 'users', currentUser.uid);
                const userSnap = await getDoc(userRef);
                
                if (userSnap.exists()) {
                    const data = userSnap.data();
                    document.getElementById('profilePhone').value = data.phone || '';
                    document.getElementById('profilePaypal').value = data.paypalEmail || '';
                    document.getElementById('profileBank').value = data.bankDetails || '';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (user && user.emailVerified) {
                currentUser = user;
                loadDashboard();
                loadProfile();
            } else if (user && !user.emailVerified) {
                window.location.href = 'login.html?verify=' + encodeURIComponent(user.email);
            } else {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>