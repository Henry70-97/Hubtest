<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - TaskMaster Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
        }

        /* Premium Admin Navigation */
        .admin-nav {
            background: linear-gradient(135deg, #1e1e2f 0%, #2d2d44 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            text-decoration: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            box-shadow: 0 2px 10px rgba(245, 87, 108, 0.3);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 20px;
            color: white;
        }

        .admin-email {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .logout-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #ff4757;
            border-color: #ff4757;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }

        /* Main Layout */
        .admin-container {
            display: flex;
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        /* Premium Sidebar */
        .admin-sidebar {
            width: 280px;
            background: white;
            box-shadow: 4px 0 20px rgba(0,0,0,0.05);
            padding: 30px 0;
            position: relative;
        }

        .admin-sidebar::after {
            content: '';
            position: absolute;
            right: 0;
            top: 10%;
            height: 80%;
            width: 3px;
            background: linear-gradient(to bottom, #667eea, #764ba2, #f093fb);
            border-radius: 3px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            padding: 15px 25px;
            margin: 5px 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #555;
            border-radius: 10px;
            font-weight: 500;
        }

        .sidebar-menu li:hover {
            background: #f8f9fa;
            color: #667eea;
            transform: translateX(5px);
        }

        .sidebar-menu li.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .sidebar-menu li i {
            font-size: 1.3rem;
            width: 25px;
        }

        /* Main Content Area */
        .admin-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8fafc;
        }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(0,0,0,0.03);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #667eea;
            font-size: 13px;
        }

        /* Section Styles */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #333;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
        }

        /* Premium Tabs */
        .premium-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .premium-tab {
            padding: 10px 25px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: #555;
        }

        .premium-tab:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .premium-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Premium Tables */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 30px;
        }

        .premium-table {
            width: 100%;
            border-collapse: collapse;
        }

        .premium-table th {
            background: #f8fafc;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: #444;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #eef2f7;
        }

        .premium-table td {
            padding: 15px;
            border-bottom: 1px solid #eef2f7;
            color: #555;
        }

        .premium-table tr:hover {
            background: #f8fafc;
        }

        .premium-table tr:last-child td {
            border-bottom: none;
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            text-transform: capitalize;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .badge-approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .badge-rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .badge-completed {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .badge-processing {
            background: #e0d4fc;
            color: #5a3e9c;
            border: 1px solid #c9b8f0;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        .badge-inactive {
            background: #e2e3e5;
            color: #383d41;
        }

        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 6px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
            letter-spacing: 0.3px;
        }

        .btn-sm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .btn-approve {
            background: #28a745;
            color: white;
        }

        .btn-reject {
            background: #dc3545;
            color: white;
        }

        .btn-view {
            background: #17a2b8;
            color: white;
        }

        .btn-edit {
            background: #ffc107;
            color: #333;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-process {
            background: #6f42c1;
            color: white;
        }

        /* Premium Forms */
        .premium-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 30px;
        }

        .form-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eef2f7;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #eef2f7;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            background: #f8fafc;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            letter-spacing: 0.5px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            background: #b3b3b3;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* Premium Modal */
        .premium-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .premium-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 2px solid #eef2f7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h2 {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Message Toast */
        .message-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 9999;
            max-width: 350px;
            display: none;
            animation: slideInRight 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message-toast.success {
            background: #28a745;
            color: white;
            border-left: 5px solid #1e7e34;
        }

        .message-toast.error {
            background: #dc3545;
            color: white;
            border-left: 5px solid #bd2130;
        }

        .message-toast.info {
            background: #17a2b8;
            color: white;
            border-left: 5px solid #117a8b;
        }

        .message-toast.warning {
            background: #ffc107;
            color: #333;
            border-left: 5px solid #d39e00;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
            background: #f8fafc;
            border-radius: 15px;
            font-size: 1.1rem;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            color: #ddd;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .admin-sidebar {
                width: 80px;
            }

            .sidebar-menu li span {
                display: none;
            }

            .sidebar-menu li i {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }

            .admin-sidebar {
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Real-time Update Indicator */
        .realtime-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            margin-left: 10px;
        }

        .realtime-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <div id="messageToast" class="message-toast"></div>

    <!-- Admin Navigation -->
    <nav class="admin-nav">
        <div class="logo-area">
            <a href="index.html" class="logo">TaskMaster Pro</a>
            <span class="admin-badge">ADMIN PANEL</span>
        </div>
        <div class="admin-profile">
            <span class="admin-email" id="adminEmail">wanyoike755@gmail.com</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <ul class="sidebar-menu">
                <li class="active" onclick="showSection('dashboard', this)">
                    <i>üìä</i> <span>Dashboard</span>
                </li>
                <li onclick="showSection('users', this)">
                    <i>üë•</i> <span>Users</span>
                </li>
                <li onclick="showSection('tasks', this)">
                    <i>üìã</i> <span>Tasks</span>
                </li>
                <li onclick="showSection('submissions', this)">
                    <i>üìù</i> <span>Submissions</span>
                </li>
                <li onclick="showSection('withdrawals', this)">
                    <i>üí∞</i> <span>Withdrawals</span>
                </li>
                <li onclick="showSection('categories', this)">
                    <i>üìÅ</i> <span>Categories</span>
                </li>
                <li onclick="showSection('announcements', this)">
                    <i>üì¢</i> <span>Announcements</span>
                </li>
                <li onclick="showSection('settings', this)">
                    <i>‚öôÔ∏è</i> <span>Settings</span>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="admin-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection">
                <div class="section-header">
                    <h2 class="section-title">Dashboard Overview</h2>
                    <span class="realtime-badge">Live Updates</span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">+12 this week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Active Tasks</h3>
                        <div class="stat-number" id="activeTasks">0</div>
                        <div class="stat-label">24 new today</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Submissions</h3>
                        <div class="stat-number" id="pendingSubmissions">0</div>
                        <div class="stat-label">Need review</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Withdrawals</h3>
                        <div class="stat-number" id="pendingWithdrawals">0</div>
                        <div class="stat-label">Total: $0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Paid</h3>
                        <div class="stat-number" id="totalPaid">$0</div>
                        <div class="stat-label">This month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Platform Revenue</h3>
                        <div class="stat-number" id="platformRevenue">$0</div>
                        <div class="stat-label">10% fee</div>
                    </div>
                </div>

                <h3 class="section-title" style="font-size: 1.3rem; margin: 30px 0 20px;">Recent Activity</h3>
                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>User</th>
                                <th>Details</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivity">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <i>üìä</i>
                                    Loading activity...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users Section -->
            <div id="usersSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">User Management</h2>
                    <span class="realtime-badge">Live Updates</span>
                </div>
                
                <div class="premium-tabs">
                    <div class="premium-tab active" onclick="filterUsers('all', this)">All Users</div>
                    <div class="premium-tab" onclick="filterUsers('active', this)">Active</div>
                    <div class="premium-tab" onclick="filterUsers('verified', this)">Verified</div>
                    <div class="premium-tab" onclick="filterUsers('unverified', this)">Unverified</div>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Joined</th>
                                <th>Tasks</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersList">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i>üë•</i>
                                    Loading users...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tasks Section -->
            <div id="tasksSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Task Management</h2>
                    <span class="realtime-badge">Live Updates - Appears to All Users</span>
                </div>
                
                <div class="premium-form">
                    <h3 class="form-title">‚ûï Create New Task</h3>
                    <div class="form-group">
                        <label>Task Title *</label>
                        <input type="text" id="taskTitle" placeholder="e.g., Complete data entry for 100 products">
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <textarea id="taskDescription" placeholder="Provide detailed instructions for the task..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Category *</label>
                            <select id="taskCategory">
                                <option value="Data Entry">üìä Data Entry</option>
                                <option value="Content Writing">‚úçÔ∏è Content Writing</option>
                                <option value="Testing">üß™ Testing</option>
                                <option value="Surveys">üìù Surveys</option>
                                <option value="Design">üé® Design</option>
                                <option value="Social Media">üì± Social Media</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Reward ($) *</label>
                            <input type="number" id="taskPrice" min="1" step="0.01" placeholder="e.g., 15.00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Deadline</label>
                            <input type="date" id="taskDeadline">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select id="taskStatus">
                                <option value="available">üü¢ Available</option>
                                <option value="in-progress">üü° In Progress</option>
                                <option value="completed">üî¥ Completed</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" onclick="createTask()" id="createTaskBtn">üöÄ Publish Task</button>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Category</th>
                                <th>Reward</th>
                                <th>Deadline</th>
                                <th>Status</th>
                                <th>Submissions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tasksList">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <i>üìã</i>
                                    Loading tasks...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Submissions Section -->
            <div id="submissionsSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Submission Reviews</h2>
                    <span class="realtime-badge">Live Updates</span>
                </div>
                
                <div class="premium-tabs">
                    <div class="premium-tab active" onclick="filterSubmissions('pending', this)">‚è≥ Pending</div>
                    <div class="premium-tab" onclick="filterSubmissions('approved', this)">‚úÖ Approved</div>
                    <div class="premium-tab" onclick="filterSubmissions('rejected', this)">‚ùå Rejected</div>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Task</th>
                                <th>Submitted</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="submissionsList">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <i>üìù</i>
                                    Loading submissions...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Withdrawals Section -->
            <div id="withdrawalsSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Withdrawal Requests</h2>
                    <span class="realtime-badge">Live Updates</span>
                </div>
                
                <div class="premium-tabs">
                    <div class="premium-tab active" onclick="filterWithdrawals('pending', this)">‚è≥ Pending</div>
                    <div class="premium-tab" onclick="filterWithdrawals('processing', this)">‚öôÔ∏è Processing</div>
                    <div class="premium-tab" onclick="filterWithdrawals('completed', this)">‚úÖ Completed</div>
                    <div class="premium-tab" onclick="filterWithdrawals('rejected', this)">‚ùå Rejected</div>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Requested</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsList">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <i>üí∞</i>
                                    Loading withdrawals...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Section -->
            <div id="categoriesSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Category Management</h2>
                    <span class="realtime-badge">Live Updates</span>
                </div>
                
                <div class="premium-form">
                    <h3 class="form-title">‚ûï Add New Category</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Category Name *</label>
                            <input type="text" id="categoryName" placeholder="e.g., Data Entry">
                        </div>
                        <div class="form-group">
                            <label>Icon *</label>
                            <input type="text" id="categoryIcon" placeholder="e.g., üìä">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Min Price ($)</label>
                            <input type="number" id="categoryMinPrice" placeholder="5">
                        </div>
                        <div class="form-group">
                            <label>Max Price ($)</label>
                            <input type="number" id="categoryMaxPrice" placeholder="50">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="addCategory()" id="addCategoryBtn">‚ûï Add Category</button>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Icon</th>
                                <th>Category</th>
                                <th>Price Range</th>
                                <th>Total Tasks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesList">
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <i>üìÅ</i>
                                    Loading categories...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Announcements Section -->
            <div id="announcementsSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Announcements</h2>
                    <span class="realtime-badge">Appears to All Users</span>
                </div>
                
                <div class="premium-form">
                    <h3 class="form-title">üì¢ Send Announcement</h3>
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" id="announcementTitle" placeholder="e.g., New Tasks Available!">
                    </div>
                    <div class="form-group">
                        <label>Message *</label>
                        <textarea id="announcementMessage" placeholder="Type your announcement here..." rows="4"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="announcementPriority">
                                <option value="normal">üîµ Normal</option>
                                <option value="important">üü† Important</option>
                                <option value="urgent">üî¥ Urgent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Expires</label>
                            <input type="date" id="announcementExpiry">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="sendAnnouncement()" id="sendAnnouncementBtn">üì¢ Broadcast to All Users</button>
                </div>

                <div class="table-container">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Message</th>
                                <th>Date</th>
                                <th>Priority</th>
                                <th>Views</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="announcementsList">
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <i>üì¢</i>
                                    No announcements yet
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Platform Settings</h2>
                </div>
                
                <div class="premium-form">
                    <h3 class="form-title">‚öôÔ∏è General Settings</h3>
                    <div class="form-group">
                        <label>Platform Name</label>
                        <input type="text" id="platformName" value="TaskMaster Pro">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Min Withdrawal ($)</label>
                            <input type="number" id="minWithdrawal" value="10" min="1">
                        </div>
                        <div class="form-group">
                            <label>Platform Fee (%)</label>
                            <input type="number" id="platformFee" value="10" min="0" max="100">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
                </div>

                <div class="premium-form">
                    <h3 class="form-title">üëë Admin Users</h3>
                    <div class="form-group">
                        <label>Current Admin</label>
                        <input type="email" id="currentAdmin" value="wanyoike755@gmail.com" readonly disabled>
                        <small style="color: #28a745;">‚úì Primary Admin</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="premium-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><span>üìù</span> Review Submission</h2>
                <button class="close-btn" onclick="closeModal('reviewModal')">&times;</button>
            </div>
            <div class="modal-body" id="reviewModalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawalModal" class="premium-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><span>üí∞</span> Process Withdrawal</h2>
                <button class="close-btn" onclick="closeModal('withdrawalModal')">&times;</button>
            </div>
            <div class="modal-body" id="withdrawalModalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="premium-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><span>‚úèÔ∏è</span> Edit Task</h2>
                <button class="close-btn" onclick="closeModal('editTaskModal')">&times;</button>
            </div>
            <div class="modal-body" id="editTaskModalBody">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { 
            getAuth, 
            signOut,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            where,
            orderBy,
            onSnapshot,
            updateDoc,
            deleteDoc,
            doc,
            getDoc,
            getDocs,
            serverTimestamp,
            limit
        } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyChk2JA68-I5s1D0S10r9WK71LgTNi4hRQ",
            authDomain: "nextgen-5fb6f.firebaseapp.com",
            projectId: "nextgen-5fb6f",
            storageBucket: "nextgen-5fb6f.firebasestorage.app",
            messagingSenderId: "100132076455",
            appId: "1:100132076455:web:c5aea1f6e1a5ebbea99482"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables
        let currentAdmin = null;
        let currentSubmissionId = null;
        let currentWithdrawalId = null;
        let currentTaskId = null;
        let currentFilter = 'all';
        let unsubscribers = {};

        // Make functions global
        window.showSection = showSection;
        window.filterUsers = filterUsers;
        window.filterSubmissions = filterSubmissions;
        window.filterWithdrawals = filterWithdrawals;
        window.createTask = createTask;
        window.editTask = editTask;
        window.deleteTask = deleteTask;
        window.reviewSubmission = reviewSubmission;
        window.processSubmission = processSubmission;
        window.processWithdrawal = processWithdrawal;
        window.updateWithdrawalStatus = updateWithdrawalStatus;
        window.addCategory = addCategory;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.sendAnnouncement = sendAnnouncement;
        window.saveSettings = saveSettings;
        window.logout = logout;
        window.closeModal = closeModal;

        // Show loading
        function showLoading(show = true) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Show message
        function showMessage(text, type) {
            const toast = document.getElementById('messageToast');
            toast.textContent = text;
            toast.className = `message-toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 4000);
        }

        // Logout
        async function logout() {
            showLoading(true);
            try {
                // Clean up listeners
                Object.values(unsubscribers).forEach(unsub => {
                    if (unsub) unsub();
                });
                
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                showMessage('Error logging out', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Show section
        function showSection(section, element) {
            // Hide all sections
            document.querySelectorAll('.admin-content > div').forEach(div => {
                div.style.display = 'none';
            });

            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu li').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected section
            document.getElementById(section + 'Section').style.display = 'block';
            element.classList.add('active');

            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'submissions':
                    loadSubmissions('pending');
                    break;
                case 'withdrawals':
                    loadWithdrawals('pending');
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'announcements':
                    loadAnnouncements();
                    break;
            }
        }

        // Load dashboard data with real-time updates
        function loadDashboardData() {
            // Users count
            if (unsubscribers.users) unsubscribers.users();
            unsubscribers.users = onSnapshot(collection(db, 'users'), (snapshot) => {
                document.getElementById('totalUsers').textContent = snapshot.size;
            });

            // Tasks count
            if (unsubscribers.tasks) unsubscribers.tasks();
            unsubscribers.tasks = onSnapshot(collection(db, 'tasks'), (snapshot) => {
                document.getElementById('activeTasks').textContent = snapshot.size;
            });

            // Pending submissions
            if (unsubscribers.pendingSubs) unsubscribers.pendingSubs();
            const pendingQuery = query(collection(db, 'submissions'), where('status', '==', 'pending'));
            unsubscribers.pendingSubs = onSnapshot(pendingQuery, (snapshot) => {
                document.getElementById('pendingSubmissions').textContent = snapshot.size;
            });

            // Pending withdrawals
            if (unsubscribers.pendingWiths) unsubscribers.pendingWiths();
            const pendingWithQuery = query(collection(db, 'withdrawals'), where('status', '==', 'pending'));
            unsubscribers.pendingWiths = onSnapshot(pendingWithQuery, (snapshot) => {
                document.getElementById('pendingWithdrawals').textContent = snapshot.size;
                
                // Calculate total pending amount
                let total = 0;
                snapshot.forEach(doc => total += doc.data().amount || 0);
                document.getElementById('pendingWithdrawals').nextElementSibling.textContent = `Total: $${total}`;
            });

            // Recent activity
            loadRecentActivity();
        }

        // Load recent activity
        async function loadRecentActivity() {
            const tbody = document.getElementById('recentActivity');
            
            try {
                const activities = [];
                
                // Get recent submissions
                const subsQuery = query(collection(db, 'submissions'), orderBy('submittedAt', 'desc'), limit(5));
                const subsSnap = await getDocs(subsQuery);
                subsSnap.forEach(doc => {
                    const data = doc.data();
                    activities.push({
                        type: 'Submission',
                        user: data.userName || 'Unknown',
                        details: `Task #${data.taskId}`,
                        amount: data.reward ? `$${data.reward}` : '-',
                        date: data.submittedAt,
                        status: data.status
                    });
                });

                // Get recent withdrawals
                const withQuery = query(collection(db, 'withdrawals'), orderBy('requestedAt', 'desc'), limit(5));
                const withSnap = await getDocs(withQuery);
                withSnap.forEach(doc => {
                    const data = doc.data();
                    activities.push({
                        type: 'Withdrawal',
                        user: data.userName || 'Unknown',
                        details: data.method,
                        amount: `$${data.amount}`,
                        date: data.requestedAt,
                        status: data.status
                    });
                });

                // Sort by date
                activities.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                if (activities.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i>üìä</i>No recent activity</td></tr>`;
                } else {
                    tbody.innerHTML = activities.slice(0, 10).map(a => `
                        <tr>
                            <td><span class="status-badge" style="background:#e3f2fd">${a.type}</span></td>
                            <td>${a.user}</td>
                            <td>${a.details}</td>
                            <td>${a.amount}</td>
                            <td>${new Date(a.date).toLocaleDateString()}</td>
                            <td><span class="status-badge badge-${a.status}">${a.status}</span></td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading activity:', error);
                tbody.innerHTML = `<tr><td colspan="6" class="empty-state">Error loading activity</td></tr>`;
            }
        }

        // Load users with real-time updates
        function loadUsers(filter = 'all') {
            const tbody = document.getElementById('usersList');
            
            let q = query(collection(db, 'users'), orderBy('createdAt', 'desc'));
            
            if (unsubscribers.usersList) unsubscribers.usersList();
            
            unsubscribers.usersList = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="7" class="empty-state"><i>üë•</i>No users found</td></tr>`;
                    return;
                }

                let users = [];
                snapshot.forEach(doc => users.push({ id: doc.id, ...doc.data() }));

                // Apply filter
                if (filter === 'active') {
                    users = users.filter(u => (u.tasksCompleted || 0) > 0);
                } else if (filter === 'verified') {
                    // You'll need to implement verification check
                }

                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 35px; height: 35px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${(user.displayName || 'U').charAt(0).toUpperCase()}
                                </div>
                                ${user.displayName || 'N/A'}
                            </div>
                        </td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A'}</td>
                        <td>${user.tasksCompleted || 0}</td>
                        <td>$${(user.balance || 0).toFixed(2)}</td>
                        <td>
                            <span class="status-badge badge-${user.emailVerified ? 'approved' : 'pending'}">
                                ${user.emailVerified ? 'Verified' : 'Unverified'}
                            </span>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn-sm btn-view" onclick="viewUser('${user.id}')">View</button>
                                <button class="btn-sm btn-edit" onclick="adjustBalance('${user.id}')">Adjust</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            });
        }

        // Filter users
        function filterUsers(filter, element) {
            // Update tab UI
            document.querySelectorAll('#usersSection .premium-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            
            loadUsers(filter);
        }

        // View user
        window.viewUser = function(userId) {
            showMessage(`Viewing user details - Feature coming soon`, 'info');
        };

        // Adjust balance
        window.adjustBalance = function(userId) {
            const amount = prompt('Enter amount to add/subtract (use - for subtraction):');
            if (amount) {
                showMessage(`Balance adjusted for user ${userId}`, 'success');
            }
        };

        // Load tasks with real-time updates
        function loadTasks() {
            const tbody = document.getElementById('tasksList');
            
            if (unsubscribers.tasksList) unsubscribers.tasksList();
            
            const q = query(collection(db, 'tasks'), orderBy('createdAt', 'desc'));
            unsubscribers.tasksList = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="7" class="empty-state"><i>üìã</i>No tasks created yet</td></tr>`;
                    return;
                }

                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const task = doc.data();
                    tbody.innerHTML += `
                        <tr>
                            <td>
                                <strong>${task.title}</strong><br>
                                <small style="color: #666;">${task.description?.substring(0, 50)}...</small>
                            </td>
                            <td>${task.category || 'N/A'}</td>
                            <td>$${task.price || 0}</td>
                            <td>${task.deadline ? new Date(task.deadline).toLocaleDateString() : 'No deadline'}</td>
                            <td><span class="status-badge badge-${task.status || 'available'}">${task.status || 'available'}</span></td>
                            <td>${task.submissions || 0}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-sm btn-edit" onclick="editTask('${doc.id}')">Edit</button>
                                    <button class="btn-sm btn-delete" onclick="deleteTask('${doc.id}')">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        // Create task
        async function createTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const category = document.getElementById('taskCategory').value;
            const price = parseFloat(document.getElementById('taskPrice').value);
            const deadline = document.getElementById('taskDeadline').value;
            const status = document.getElementById('taskStatus').value;

            if (!title || !description || !price) {
                showMessage('Please fill in all required fields', 'error');
                return;
            }

            showLoading(true);
            document.getElementById('createTaskBtn').disabled = true;

            try {
                // Add to Firestore - this will automatically appear to all users
                await addDoc(collection(db, 'tasks'), {
                    title: title,
                    description: description,
                    category: category,
                    price: price,
                    deadline: deadline || null,
                    status: status,
                    submissions: 0,
                    createdAt: new Date().toISOString(),
                    createdBy: currentAdmin?.email,
                    lastUpdated: new Date().toISOString()
                });

                showMessage('Task created successfully! It will appear to all users instantly.', 'success');
                
                // Clear form
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskPrice').value = '';
                document.getElementById('taskDeadline').value = '';

            } catch (error) {
                console.error('Error creating task:', error);
                showMessage('Error creating task: ' + error.message, 'error');
            } finally {
                showLoading(false);
                document.getElementById('createTaskBtn').disabled = false;
            }
        }

        // Edit task
        function editTask(taskId) {
            currentTaskId = taskId;
            
            document.getElementById('editTaskModalBody').innerHTML = `
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="editTaskTitle" class="form-control" placeholder="Task title">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editTaskDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Price ($)</label>
                        <input type="number" id="editTaskPrice" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editTaskStatus" class="form-control">
                            <option value="available">Available</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                <button class="btn-primary" onclick="updateTask()">Update Task</button>
            `;
            
            // Load task data
            getDoc(doc(db, 'tasks', taskId)).then(docSnap => {
                if (docSnap.exists()) {
                    const task = docSnap.data();
                    document.getElementById('editTaskTitle').value = task.title || '';
                    document.getElementById('editTaskDescription').value = task.description || '';
                    document.getElementById('editTaskPrice').value = task.price || '';
                    document.getElementById('editTaskStatus').value = task.status || 'available';
                }
            });
            
            document.getElementById('editTaskModal').classList.add('active');
        }

        // Update task
        window.updateTask = async function() {
            const title = document.getElementById('editTaskTitle').value.trim();
            const description = document.getElementById('editTaskDescription').value.trim();
            const price = parseFloat(document.getElementById('editTaskPrice').value);
            const status = document.getElementById('editTaskStatus').value;

            if (!title || !description || !price) {
                showMessage('Please fill in all fields', 'error');
                return;
            }

            showLoading(true);

            try {
                await updateDoc(doc(db, 'tasks', currentTaskId), {
                    title: title,
                    description: description,
                    price: price,
                    status: status,
                    lastUpdated: new Date().toISOString()
                });

                showMessage('Task updated successfully! Changes visible to all users.', 'success');
                closeModal('editTaskModal');

            } catch (error) {
                console.error('Error updating task:', error);
                showMessage('Error updating task', 'error');
            } finally {
                showLoading(false);
            }
        };

        // Delete task
        async function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task? This will remove it for all users.')) {
                showLoading(true);
                try {
                    await deleteDoc(doc(db, 'tasks', taskId));
                    showMessage('Task deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting task:', error);
                    showMessage('Error deleting task', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }

        // Load submissions with real-time updates
        function loadSubmissions(status) {
            const tbody = document.getElementById('submissionsList');
            
            if (unsubscribers.submissions) unsubscribers.submissions();
            
            const q = query(
                collection(db, 'submissions'),
                where('status', '==', status),
                orderBy('submittedAt', 'desc')
            );
            
            unsubscribers.submissions = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i>üìù</i>No ${status} submissions</td></tr>`;
                    return;
                }

                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const sub = doc.data();
                    tbody.innerHTML += `
                        <tr>
                            <td>${sub.userName || 'Unknown'}</td>
                            <td>${sub.taskTitle || `Task #${sub.taskId}`}</td>
                            <td>${new Date(sub.submittedAt).toLocaleDateString()}</td>
                            <td>$${sub.reward || 0}</td>
                            <td><span class="status-badge badge-${sub.status}">${sub.status}</span></td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-sm btn-view" onclick="reviewSubmission('${doc.id}')">Review</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        // Filter submissions
        function filterSubmissions(status, element) {
            document.querySelectorAll('#submissionsSection .premium-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            loadSubmissions(status);
        }

        // Review submission
        async function reviewSubmission(submissionId) {
            currentSubmissionId = submissionId;
            
            try {
                const docSnap = await getDoc(doc(db, 'submissions', submissionId));
                
                if (docSnap.exists()) {
                    const sub = docSnap.data();

                    document.getElementById('reviewModalBody').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px;">Submission Details</h3>
                            
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                <p><strong>üë§ User:</strong> ${sub.userName}</p>
                                <p><strong>üìã Task:</strong> ${sub.taskTitle || `Task #${sub.taskId}`}</p>
                                <p><strong>üí∞ Reward:</strong> $${sub.reward || 0}</p>
                                <p><strong>üìÖ Submitted:</strong> ${new Date(sub.submittedAt).toLocaleString()}</p>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; display: block; margin-bottom: 8px;">Work Submitted:</label>
                                <div style="background: #f8fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                                    ${sub.work}
                                </div>
                            </div>

                            ${sub.notes ? `
                                <div style="margin-bottom: 15px;">
                                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">User Notes:</label>
                                    <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                                        ${sub.notes}
                                    </div>
                                </div>
                            ` : ''}

                            <div class="form-group">
                                <label>Your Feedback</label>
                                <textarea id="adminFeedback" rows="4" placeholder="Provide feedback to the user..."></textarea>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn-primary" style="flex: 1; background: #28a745;" onclick="processSubmission('${submissionId}', 'approved')">‚úÖ Approve & Pay</button>
                                <button class="btn-primary" style="flex: 1; background: #dc3545;" onclick="processSubmission('${submissionId}', 'rejected')">‚ùå Reject</button>
                            </div>
                        </div>
                    `;

                    document.getElementById('reviewModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading submission:', error);
                showMessage('Error loading submission', 'error');
            }
        }

        // Process submission
        async function processSubmission(submissionId, status) {
            const feedback = document.getElementById('adminFeedback')?.value.trim() || 'No feedback provided';

            showLoading(true);

            try {
                const submissionRef = doc(db, 'submissions', submissionId);
                const submissionSnap = await getDoc(submissionRef);
                const submission = submissionSnap.data();

                // Update submission
                await updateDoc(submissionRef, {
                    status: status,
                    reviewedAt: new Date().toISOString(),
                    reviewedBy: currentAdmin?.email,
                    adminFeedback: feedback
                });

                // If approved, update user balance
                if (status === 'approved' && submission.reward) {
                    const usersQuery = query(collection(db, 'users'), where('uid', '==', submission.userId));
                    const usersSnap = await getDocs(usersQuery);
                    
                    if (!usersSnap.empty) {
                        const userDoc = usersSnap.docs[0];
                        const userData = userDoc.data();
                        
                        await updateDoc(doc(db, 'users', userDoc.id), {
                            balance: (userData.balance || 0) + submission.reward,
                            totalEarnings: (userData.totalEarnings || 0) + submission.reward,
                            tasksCompleted: (userData.tasksCompleted || 0) + 1
                        });
                    }
                }

                // Add feedback to user's feedback collection
                await addDoc(collection(db, 'feedback'), {
                    userId: submission.userId,
                    taskId: submission.taskId,
                    message: feedback,
                    status: status,
                    createdAt: new Date().toISOString(),
                    adminResponse: status === 'approved' ? '‚úÖ Your submission has been approved!' : '‚ùå Your submission has been rejected.'
                });

                showMessage(`Submission ${status}! User notified.`, 'success');
                closeModal('reviewModal');

            } catch (error) {
                console.error('Error processing submission:', error);
                showMessage('Error processing submission', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load withdrawals with real-time updates
        function loadWithdrawals(status) {
            const tbody = document.getElementById('withdrawalsList');
            
            if (unsubscribers.withdrawals) unsubscribers.withdrawals();
            
            const q = query(
                collection(db, 'withdrawals'),
                where('status', '==', status),
                orderBy('requestedAt', 'desc')
            );
            
            unsubscribers.withdrawals = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i>üí∞</i>No ${status} withdrawals</td></tr>`;
                    return;
                }

                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const w = doc.data();
                    tbody.innerHTML += `
                        <tr>
                            <td>${w.userName || 'Unknown'}</td>
                            <td>$${w.amount}</td>
                            <td>${w.method}</td>
                            <td>${new Date(w.requestedAt).toLocaleDateString()}</td>
                            <td><span class="status-badge badge-${w.status}">${w.status}</span></td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-sm btn-view" onclick="processWithdrawal('${doc.id}')">Process</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        // Filter withdrawals
        function filterWithdrawals(status, element) {
            document.querySelectorAll('#withdrawalsSection .premium-tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            loadWithdrawals(status);
        }

        // Process withdrawal
        async function processWithdrawal(withdrawalId) {
            currentWithdrawalId = withdrawalId;
            
            try {
                const docSnap = await getDoc(doc(db, 'withdrawals', withdrawalId));
                
                if (docSnap.exists()) {
                    const w = docSnap.data();

                    document.getElementById('withdrawalModalBody').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px;">Withdrawal Details</h3>
                            
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                <p><strong>üë§ User:</strong> ${w.userName}</p>
                                <p><strong>üí∞ Amount:</strong> $${w.amount}</p>
                                <p><strong>üí≥ Method:</strong> ${w.method}</p>
                                <p><strong>üìÖ Requested:</strong> ${new Date(w.requestedAt).toLocaleString()}</p>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; display: block; margin-bottom: 8px;">Account Details:</label>
                                <div style="background: #f8fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                                    ${w.accountDetails}
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Admin Notes</label>
                                <textarea id="adminWithdrawalNotes" rows="3" placeholder="Add notes about this withdrawal..."></textarea>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                                <button class="btn-primary" style="flex: 1; background: #28a745;" onclick="updateWithdrawalStatus('${withdrawalId}', 'completed')">‚úÖ Mark Completed</button>
                                <button class="btn-primary" style="flex: 1; background: #6f42c1;" onclick="updateWithdrawalStatus('${withdrawalId}', 'processing')">‚öôÔ∏è Processing</button>
                                <button class="btn-primary" style="flex: 1; background: #dc3545;" onclick="updateWithdrawalStatus('${withdrawalId}', 'rejected')">‚ùå Reject</button>
                            </div>
                        </div>
                    `;

                    document.getElementById('withdrawalModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading withdrawal:', error);
                showMessage('Error loading withdrawal', 'error');
            }
        }

        // Update withdrawal status
        async function updateWithdrawalStatus(withdrawalId, status) {
            const notes = document.getElementById('adminWithdrawalNotes')?.value.trim() || '';

            showLoading(true);

            try {
                const withdrawalRef = doc(db, 'withdrawals', withdrawalId);
                const withdrawalSnap = await getDoc(withdrawalRef);
                const withdrawal = withdrawalSnap.data();

                await updateDoc(withdrawalRef, {
                    status: status,
                    processedAt: new Date().toISOString(),
                    processedBy: currentAdmin?.email,
                    adminNotes: notes
                });

                // If rejected, refund the amount
                if (status === 'rejected') {
                    const usersQuery = query(collection(db, 'users'), where('uid', '==', withdrawal.userId));
                    const usersSnap = await getDocs(usersQuery);
                    
                    if (!usersSnap.empty) {
                        const userDoc = usersSnap.docs[0];
                        const userData = userDoc.data();
                        
                        await updateDoc(doc(db, 'users', userDoc.id), {
                            balance: (userData.balance || 0) + withdrawal.amount
                        });
                    }
                }

                showMessage(`Withdrawal ${status}!`, 'success');
                closeModal('withdrawalModal');

            } catch (error) {
                console.error('Error updating withdrawal:', error);
                showMessage('Error updating withdrawal', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load categories
        function loadCategories() {
            const categories = [
                { icon: 'üìä', name: 'Data Entry', min: 5, max: 20, tasks: 15 },
                { icon: '‚úçÔ∏è', name: 'Content Writing', min: 10, max: 50, tasks: 8 },
                { icon: 'üß™', name: 'Testing', min: 15, max: 30, tasks: 12 },
                { icon: 'üìù', name: 'Surveys', min: 2, max: 10, tasks: 25 },
                { icon: 'üé®', name: 'Design', min: 20, max: 100, tasks: 6 },
                { icon: 'üì±', name: 'Social Media', min: 1, max: 5, tasks: 30 }
            ];

            const tbody = document.getElementById('categoriesList');
            tbody.innerHTML = categories.map((cat, index) => `
                <tr>
                    <td style="font-size: 1.5rem;">${cat.icon}</td>
                    <td><strong>${cat.name}</strong></td>
                    <td>$${cat.min} - $${cat.max}</td>
                    <td>${cat.tasks} tasks</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-sm btn-edit" onclick="editCategory(${index})">Edit</button>
                            <button class="btn-sm btn-delete" onclick="deleteCategory(${index})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Add category
        function addCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const icon = document.getElementById('categoryIcon').value.trim();
            const min = document.getElementById('categoryMinPrice').value;
            const max = document.getElementById('categoryMaxPrice').value;

            if (!name || !icon) {
                showMessage('Please fill in category name and icon', 'error');
                return;
            }

            showMessage('Category added successfully!', 'success');
            
            // Clear form
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryIcon').value = '';
            document.getElementById('categoryMinPrice').value = '';
            document.getElementById('categoryMaxPrice').value = '';

            loadCategories();
        }

        // Edit category
        window.editCategory = function(index) {
            showMessage('Edit category feature coming soon', 'info');
        };

        // Delete category
        window.deleteCategory = function(index) {
            if (confirm('Are you sure you want to delete this category?')) {
                showMessage('Category deleted', 'success');
            }
        };

        // Load announcements
        function loadAnnouncements() {
            const tbody = document.getElementById('announcementsList');
            
            if (unsubscribers.announcements) unsubscribers.announcements();
            
            const q = query(collection(db, 'announcements'), orderBy('createdAt', 'desc'));
            
            unsubscribers.announcements = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="6" class="empty-state"><i>üì¢</i>No announcements yet</td></tr>`;
                    return;
                }

                tbody.innerHTML = '';
                snapshot.forEach(doc => {
                    const a = doc.data();
                    tbody.innerHTML += `
                        <tr>
                            <td><strong>${a.title}</strong></td>
                            <td>${a.message.substring(0, 50)}...</td>
                            <td>${new Date(a.createdAt).toLocaleDateString()}</td>
                            <td><span class="status-badge" style="background: ${a.priority === 'urgent' ? '#dc3545' : a.priority === 'important' ? '#ffc107' : '#17a2b8'}; color: white;">${a.priority}</span></td>
                            <td>${a.views || 0}</td>
                            <td>
                                <button class="btn-sm btn-delete" onclick="deleteAnnouncement('${doc.id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            });
        }

        // Send announcement
        async function sendAnnouncement() {
            const title = document.getElementById('announcementTitle').value.trim();
            const message = document.getElementById('announcementMessage').value.trim();
            const priority = document.getElementById('announcementPriority').value;
            const expiry = document.getElementById('announcementExpiry').value;

            if (!title || !message) {
                showMessage('Please enter title and message', 'error');
                return;
            }

            showLoading(true);
            document.getElementById('sendAnnouncementBtn').disabled = true;

            try {
                await addDoc(collection(db, 'announcements'), {
                    title: title,
                    message: message,
                    priority: priority,
                    expiry: expiry || null,
                    createdAt: new Date().toISOString(),
                    createdBy: currentAdmin?.email,
                    views: 0,
                    active: true
                });

                showMessage('Announcement sent to all users!', 'success');
                
                // Clear form
                document.getElementById('announcementTitle').value = '';
                document.getElementById('announcementMessage').value = '';

            } catch (error) {
                console.error('Error sending announcement:', error);
                showMessage('Error sending announcement', 'error');
            } finally {
                showLoading(false);
                document.getElementById('sendAnnouncementBtn').disabled = false;
            }
        }

        // Delete announcement
        window.deleteAnnouncement = async function(announcementId) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                showLoading(true);
                try {
                    await deleteDoc(doc(db, 'announcements', announcementId));
                    showMessage('Announcement deleted', 'success');
                } catch (error) {
                    console.error('Error deleting announcement:', error);
                    showMessage('Error deleting announcement', 'error');
                } finally {
                    showLoading(false);
                }
            }
        };

        // Save settings
        function saveSettings() {
            showMessage('Settings saved successfully!', 'success');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Check authentication
        onAuthStateChanged(auth, async (user) => {
            if (user && user.emailVerified) {
                // Check if user is the admin
                if (user.email === 'wanyoike755@gmail.com') {
                    currentAdmin = user;
                    document.getElementById('adminEmail').textContent = user.email;
                    showMessage('Welcome Admin!', 'success');
                    loadDashboardData();
                } else {
                    // Not authorized
                    showMessage('You do not have admin access', 'error');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }
            } else if (user && !user.emailVerified) {
                window.location.href = 'login.html?verify=' + encodeURIComponent(user.email);
            } else {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>